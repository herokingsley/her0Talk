## 毕设提纲

目录

一、引言

(为什么要以这个毕业设计为题。)
在当今的互联网浪潮下，各种应用软件层出不穷，而形形色色的应用软件，都加入了网络交互的内容。在这个讲究“云计算”、“云存储”的时代，我们的信息存储在网上，我们的一次与软件的交互，往往通过网络，从世界的各个部分返回信息。

在几家公司实习后，发现服务端开发工程师在编码方面，不仅需要处理网络编程处理世界各地的数据连接，还需要将业务逻辑实现，将业务数据返回，这样往往会使业务代码和网络编程的代码相互混合，使得工程上各个组件间的耦合性较大。因此，很多企业在内部都有自己的一套网络编程库，提高工程效率。

本篇毕业论文就是站在这个角度上，希望通过自己的努力，去使得这个情况有所改观。我的目的是开发出一个以C++为开发语言的编程网络库，将网络编程的开发模块化，减轻重复的网络通信的代码的编写，让工程师的重心回归到业务上，将业务代码和网络库代码隔离，使得项目更符合软件工程的规范。

二、设计思路

一些基础知识的归纳 

IO的5种模型

1、阻塞式IO，调用read等函数会阻塞在系统调用中，直到有数据返回才会返回到应用程序中。缺点：应用程序会被单个连接阻塞而无法处理其他连接
2、非阻塞式IO，调用read等函数如果没数据返回会返回一个linux下的一个错误，也被称为轮训式IO，缺点：对CPU的利用率较低。
3、IO多路复用，利用poll/epoll/select/kqueue这几个模型监听多个fd，将阻塞在多路复用上，当指定数目的事件到达或是阻塞超时的时候返回。
4、信号驱动式IO，当有数据到达时系统发送信号给应用程序并让应用程序将数据从内核缓冲区拷贝到应用缓冲区。
5、异步IO，当有数据到达时系统将内核缓冲区的数据拷贝到应用缓冲区才返回，如：windows下的IOCP。

TCP网络编程事件的简单抽象。
1、连接的建立。(客户端connect与服务端accept对）
2、连接的断开，包括主动断开（close、shutdown）和被动断开(read返回0，即对端发送RST）
3、消息到达，文件描述符可读（业务逻辑关注的核心，客户端和服务端信息的交互）
4、消息发送完毕，即阻塞式write返回，本质上是数据已经写入了操作系统内核的缓冲区。

并发网络库

首先，我们来确定网络库的编程模型。对于网络编程来说，常用的模型发展大致如下。最直截了当的模型就是我们在计算机网络编程中学习的阻塞式IO的编写，这个模型的缺点显而易见。虽然极其容易编写，但是我们的应用程序只能够同时处理单个单向的数据传输，效率实在太低。于是，又延伸出两种模型，服务端接收到一个新的客户端连接后(accept返回后），采用新开进程或是新开线程的方式处理这个客户端连接。这两种方式都存在着当并发连接数不断增多时，对系统的资源消耗过大，资源利用率较低的缺点，而且每次新建进程或是线程都需要额外开销，在此基础上有人又提出了在应用程序初始化的时候预先新建出进程（对同样的资源进行复制）或线程，但是依然存在着系统资源有限的困局。于是，凭借着系统级的IO多路复用的提出，Reactor模型也应运而生。

Reactor模型的本质在于事件驱动。它和我们上面提出的各种模型有着一个很大的差别。上述的各种模型都是主动去调用网络的IO函数(read、write)等，而Reactor则恰恰相反，使用IO多路复用后(在Linux平台我们使用epoll），我们把需要监听的网络IO事件及其相关的文件描述符加入epoll的队列中，并将相应事件的处理函数绑定在事件循环对象相应的槽里。这样，当有网络事件的时候，Reactor模型的事件循环对象会主动地回调我们之前注册的函数。

这个模型对于网络库的编写是有着十分的优势的。从上面的描述我们可以看到，在Reactor中，网络通信的代码和业务处理的代码（即我们注册的处理函数）是分开的，有助于我们将网络通信IO的部分提取为公用的框架或者库，使用者只需要编写关键的业务逻辑代码，并通过注册回调或是复写虚函数的方式，就可以实现完整的网络服务。另外使用IO多路复用有助于提高并发连接数，在现代的网络编程中，单机同时处理十万并发已经不成问题。

因此，我决定以Reactor为设计并发网络库的模型，并提出两个具体的实施方案，(1)单线程的Reactor，Reactor触发网络事件后，串行处理网络事件。（2）单个reactor配上多个工作线程来处理业务回调函数。

两个方案的一些对比：（1）方案无论是网络库的代码还是使用库的应用程序的代码相对都比较简单，但是处理的业务不能够是太过耗时的任务，否则会影响其他事件。（2）方案则需要处理多线程中同步、竞争等问题，代码相对更为复杂，但是能够实现更多样化的网络服务，对使用库的工程师要求也更高。

最终我们以（1）方案为基础进行这次设计。（时间足够则进行（2）方案的扩展）。

三、设计内容

框架业务逻辑图：
（当连接到达网络库发生的事情。）

类图：（网络库结构）

各部件的详解：

Reactor设计模式。

EventLoop

IO多路复用。

性能测试的方法


四、结论

实现的网络库的效率测试，并提供以此网络库为基础扩展出来的应用(简单的比如echo、time、day、discard服务器等)



五、参考文献

六、附录（代码文件）

（github地址）